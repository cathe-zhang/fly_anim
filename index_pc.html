<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>抽个bmw</title>
  <style>
    body {
      text-align: center;
    }
    body {
        /* background-color: #000066; */
      }
    button {
      width: 400px;
      height: 80px;
      margin: 200px auto;
      font-size: 30px;
    }
    #car-box {
      position: relative;
      /* width: 400px;
      height: 200px; */
      margin: 0 auto;
      /* background-color: #45aafa; */
      /* background: url("./images/黑车.png") no-repeat center / 100% 100%; */
    }
    #car-box img {
      width: 100%;
      height: 100%;
    }
    .false-car {
      position: absolute;
      width: 100%;
      height: 100%;
      top: 0;
      left: 0;
    }
    #game-box {
      width: 100vw;
      height: 100vh;
      position: relative;
      box-sizing: border-box;
      background: url('./images/背景.png') no-repeat center / 100% 100%;
    }
    .fly-ele {
      width: 40px;
      height: 40px;
      background-color: #222;
      color: #fff;
    }
    #go-btn {
      position: absolute;
      bottom: 0;
    }
    .phone-num-box {

    }
    .phone-number-item {
      width: 120px;
      height: 200px;
    }
  </style>
</head>
<body>
  
  <script src="./jquery.min.js"></script>
  <script language="JavaScript">

    function startGradient() {
      alert('开始渐变')
      $('.false-car').animate({
        opacity: 0
      },1200)
      
    }

    $(function(){
      console.log(12111111111111)
      console.log($)
      // 开始飞行动画
      function startFly(){
        console.log(flyEle)
        console.log('document.documentElement.clientHeight', document.documentElement.clientHeight)
        console.log($('#car-box')[0].offsetLeft)
        console.log($('#car-box')[0].offsetTop)

        
        
        flyEle[0].style.position = 'absolute',
        flyEle[0].style.top = currentTop + 'px'
        flyEle[0].style.left = currentLeft + 'px'

        if ( currentTop > bmwBoxTop ) {
          verticalDirection = 'toUp'
        }
        else {
          verticalDirection = 'toDown'
        }
        if ( currentLeft > bmwBoxLeft ) {
          horizontalDirection = 'toLeft'
        }
        else {
          horizontalDirection = 'toRight'
        }

        // startAnimate( verticalDirection, horizontalDirection )

        
      }

      

      // $('#go-btn').on('click', startFly)
      
      let clientHeight = document.documentElement.clientHeight
      let clientWidth = document.documentElement.clientWidth
      $('#game-box').css({
        height: clientHeight + 'px',
        paddingTop: clientHeight*123/764 + 'px'
      })
      // $('body').css({
      // })
      $('#car-box').css({
        width: clientWidth*916/1297 + 'px',
        // height: clientHeight*420/764 + 'px',
      })
      // $('.go-btn').on('click',function(){
      //   console.log(111111111111)
      //   startFly()
      // })


      let eleTopArr = []    // 元素top数组
      let eleLeftArr = []   // 元素left数组
      let eleCount = 2;   // 元素个数

      var singleDuration = 1000       // 运动时间

      console.log('Math.random() * clientHeight',Math.random() * clientHeight)

      // for ( var i=0; i<eleCount; i++ ) {
      //   var curEle = document.createElement('div')
      //   curEle.classList.add('fly-ele-'+i)
      //   curEle.classList.add('fly-ele')
      //   curEle.innerText = '飞行盒子'    // 手机号
      //   $('#game-box').append(curEle)
      // }

      var flyEle = $('.fly-ele-1')
      console.log('flyEle', flyEle)

      var bmwBoxLeft = $('#car-box')[0].offsetLeft   // 目标横坐标
      var bmwBoxTop = $('#car-box')[0].offsetTop   // 目标纵坐标


      


      // let currentTop = Math.random() * clientHeight
      // let currentLeft = Math.random() * clientWidth

      let currentTop = Math.random() * clientHeight
      let currentLeft = Math.random() * clientWidth

      
      
      
      
      
      /**
       * 单个元素动画
       * @param verticalDirection 垂直运动方向
       * @param horizontalDirection 水平运动方向
       * */
      function startAnimate( verticalDirection, horizontalDirection ) {
        console.log('垂直方向', verticalDirection)
        console.log('水平方向', horizontalDirection)
        console.log('当前垂直位置', currentTop)
        console.log('当前水平位置', currentLeft)
        console.log('目标垂直位置', bmwBoxTop)
        console.log('目标水平位置', bmwBoxLeft)
        console.log('每秒垂直速度', (bmwBoxTop-currentTop)/20)
        console.log('每秒水平速度', (bmwBoxLeft-currentLeft)/20)


        setInterval(() => {
          


          if ( verticalDirection === 'toDown' ) {
            flyEle[0].style.top = parseInt(flyEle[0].style.top) + (bmwBoxTop-currentTop)/20 + 'px'
            if ( parseInt(flyEle[0].style.top) > bmwBoxTop ) {
              flyEle[0].style.top = currentTop + 'px'
              flyEle[0].style.left = currentLeft + 'px'
            }
            // if ( parseInt(flyEle[0].style.left) > bmwBoxLeft ) {
            //   flyEle[0].style.top = currentTop + 'px'
            //   flyEle[0].style.left = currentLeft + 'px'
            // }
          }
          else {
            var testVar = (parseInt(flyEle[0].style.top) - (currentTop-bmwBoxTop)/20 + 'px')
            flyEle[0].style.top = parseInt(flyEle[0].style.top) - (currentTop-bmwBoxTop)/20 + 'px'
            console.log((currentTop-bmwBoxTop)/20)
            console.log(flyEle[0].style.top)
            console.log(parseInt(flyEle[0].style.top) - (currentTop-bmwBoxTop)/20)
            console.log(parseInt(flyEle[0].style.top) - (currentTop-bmwBoxTop)/20 + 'px')
            console.log(flyEle[0].style.top, 111111111111111111111)
            console.log(testVar, 'testVar')
            if ( parseInt(flyEle[0].style.top) < bmwBoxTop ) {
              flyEle[0].style.top = currentTop + 'px'
              flyEle[0].style.left = currentLeft + 'px'
            }
          }

          if ( horizontalDirection === 'toRight' ) {
            flyEle[0].style.left = parseInt(flyEle[0].style.left) + (bmwBoxLeft-currentLeft)/20 +'px'
            if ( parseInt(flyEle[0].style.left) > bmwBoxLeft ) {
              flyEle[0].style.left = currentLeft + 'px'
              flyEle[0].style.top = currentTop + 'px'
            }
          }
          else {
            flyEle[0].style.left = parseInt(flyEle[0].style.left) - (currentLeft-bmwBoxLeft)/20 +'px'
            if ( parseInt(flyEle[0].style.left) < bmwBoxLeft ) {
              flyEle[0].style.left = currentLeft + 'px'
              flyEle[0].style.top = currentTop + 'px'
            }
          }
          // console.log(flyEle[0].style.left)
          // console.log(flyEle[0].style.top)
        }, 300);
      }



      var isGaming = false
      var winner = ''
    
      queryPhoneNumList()

     
      // 获取手机号码数据
      function queryPhoneNumList(){
        $.ajax({
          method: 'post',
          url: 'https://wldoperation.58wld.com/go.php/Index/getData',
          data: {},
          success: function(res){
            console.log('获取手机号码成功')
            $('.phone-num-box').append(`<div>
              </div>`)
          }
        })
      }

      // 立即开启
      function open(){
        $.ajax({
          method: 'post',
          url: 'https://wldoperation.58wld.com/go.php/Index/initActive',
          data: {},
          success: function(res){
            if ( res.code === 0 ) {
              alert('开启成功')
            }
          }
        })
      }

      // 开始抽奖
      function startBtnClick() {
        console.log('startBtnClick')
        if ( isGaming ) {
          console.log('停止抽奖')
          isGaming = false
          alert(winner)
          console.log(11111111111111111)
          $('.start-btn').text('开始抽奖')
        }
        else {
          console.log('开始抽奖')
          console.log(22222222222222)
          // 开始手机号滚动动画
          $.ajax({
            method: 'post',
            url: 'https://wldoperation.58wld.com/go.php/Index/startGame',
            data: {},
            success: function(res){
              console.log('res',res)
              if ( res.code === 0 ) {
                $('.start-btn').text('停止抽奖')
                isGaming = true
                let result = res.data.c_phone
                // alert(`抽奖成功：${result}`)
                winner = result
                
              }
              else if ( res.code === 1001 ) {
                alert(res.msg)
              }
            },
            error: function(err) {
              alert(err.msg)
            }
          })
        }
      }

      // 立即开启按钮点击
      $('.open-btn').on('click', function(){
        open()
      })

      // 开始抽奖按钮点击
      $('.start-btn').on('click', startBtnClick)


      $('.phone-num-box').html(`
        <div class="phone-number-item"></div>
      `)

      
      


    })



    // xL = 8;
    //   xH = xW = xR = xE = xMY = xMX = xWd = xHd = 0;
    //   xF = new Array();
    //   xY = new Array();
    //   xX = new Array();
    //   xS = new Array();
    //   xA = new Array();
    //   xB = new Array();
    //   ini = new Array();
      
    //   document.write(
    //     '<div id="sdiv" style="position:absolute;top:0px;left:0px"><div style="position:relative">'
    //   );
    //   for (i = 0; i < xL; i++) {
    //     document.write(
    //       '<div id="div" style="position:absolute;top:0;left:0;width:5px;height:5px;' +
    //         'font-size:10px;color:#ffffff">.</div>'
    //     );
    //   }
    //   document.write("</div></div>");


    //   function Set() {
    //     for (i = 0; i < xL; i++) {
    //       transfer(i);
    //       xF[i] = xW / 14;
    //     }
    //     console.log('xF',xF)
    //   }
    //   function Assign() {
    //     sdiv.style.top = document.body.scrollTop;    // 居中
    //     for (i = 0; i < xL; i++) {
    //       xF[i] -= xS[i] * 25;
    //       if (xF[i] < 4) xF[i] = 3;
    //       div[i].style.top = xY[i];
    //       div[i].style.left = xX[i];
    //       div[i].style.fontSize = xF[i];
    //     }
    //   }
    //   function fly() {
    //     xMY = window.document.body.clientHeight / 2;   // 屏幕高度的一半
    //     xMX = window.document.body.clientWidth / 2;   // 屏幕宽度的一半
    //     xWd = Math.round(Math.random() * 40 + 5);    // xWd 5-45的随机整数
    //     xHd = Math.round(Math.random() * 30 + 5);    // xHd 5-35的随机整数
    //     for (i = 0; i < xL; i++) {
    //       xY[i] = xA[i] += (xMY - xA[i]) * xS[i];
    //       xX[i] = xB[i] += (xMX - xB[i]) * xS[i];
    //       if (
    //         xX[i] > xMX - xWd &&
    //         xX[i] < xMX + xWd &&
    //         xY[i] > xMY - xHd &&
    //         xY[i] < xMY + xHd
    //       ) {
    //         transfer(i);
    //       }
    //       if (xX[i] < 0 || xX[i] > xW || xY[i] < 0 || xY[i] > xH) {
    //         xF[i] = xW / 14;
    //       }
    //     }
    //     Assign();
    //     // setTimeout("fly()", 1);
    //   }
    //   function transfer(i) {
    //     xH = window.document.body.offsetHeight;    // 屏幕高度
    //     xW = window.document.body.offsetWidth;    // 屏幕宽度
    //     console.log(xH, xW)
    //     xA[i] = Math.round(Math.random() * xH);     // xA元素 屏幕高度的随机百分比
    //     xB[i] = Math.round(Math.random() * xW);     // xB元素 屏幕宽度的随机百分比
    //     xS[i] = Math.random() * 0.05 + 0.05;    // xS元素 0.05 到 0.15 的随机数
    //     xR = Math.round(Math.random() * 3);     // xR元素 0-3的随机整数
    //     xE = Math.round(Math.random() * 50 + 50);   // xE元素 50-100的随机整数
    //     if (xR == 3) xB[i] = -xE;             // xB元素 如果xR等于3 则为 -50至-100的随机整数
    //     if (xR == 2) xB[i] = xW + xE;         // xB元素 如果xR等于2 则为 屏幕宽度+ 50-100的随机整数
    //     if (xR == 1) xA[i] = -xE;            // xA元素 如果xR等于1 则为-50至-100的随机整数
    //     if (xR == 0) xA[i] = xH;            // xA元素 如果xR等于0 则为屏幕高度
    //   }
    //   Set();
    //   fly();
    
    
  </script>

  <div id="game-box">
    <!-- <div id="title">
      筑梦 - 燎原
    </div>
    <div id="sub-title">
      <div>宝马豪车</div>
      <div>
        锦鲤会员幸运大奖
      </div>
    </div>
    <button class="open-btn">开启</button> -->
    <!-- <button class="start-btn">开始抽奖</button> -->
    <!-- <div class="phone-num-box">
      <div class="phone-number-item">
        1
      </div>
    </div> -->
    <div id="car-box">
      <img class="true-car" src="./images/红车@2x.png"></img>
      <img class="false-car" src="./images/光@2x.png" />
    </div>
    <img id="go-btn" src="./images/椭圆 1.png" />
    <!-- <button onclick="startGradient()">开始</button> -->


    
    
  </div>
</body>
</html>